name: 8.5.x-TT.x

on:
  push:
    branches:
      - 8.5.x-TT.x
  pull_request:
    branches:
      - 8.5.x-TT.x
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: setup jdk 11
      uses: actions/setup-java@v1
      with:
        java-version: '11'
    
    - name: donwload ant 
      run: curl https://archive.apache.org/dist/ant/binaries/apache-ant-1.10.13-bin.zip --output ant9.zip

    - name: unzip ant 9
      run: unzip -qq ant9.zip

    - name: default os ant version to 1.10.13
      run:  sudo cp -a apache-ant-1.10.13/. $ANT_HOME

    - name: download libraries
      run: curl https://support-delivery.s3.amazonaws.com/tomcat7-build-libs.zip --output tomcat7-build-libs-.zip
      
    - name: extract libs
      run: unzip -qq tomcat7-build-libs-.zip -d /home/runner/

    - name: ant_build
      run: ant

    - name: ant_test
      run: ant test | true
      env:
          ANT_OPTS: -Xmx2G -XX:MaxPermSize=512m

    - name: obtained_error_result
      run: grep 'Caused an ERROR' output/build/logs/* > error_result.txt | true
      
    - name: obtained_failed_result
      run: grep 'FAILED' output/build/logs/* > failed_result.txt | true
    
    - name: print_error
      run: cat error_result.txt
      
    - name: print_failed
      run: cat failed_result.txt 
 
    - name: expected_error_and_failed_result
      run: touch known_errors.txt && touch known_failed.txt

#Known ERRORS   
 

#Known FAILED
   
#Final test check

    - name: final_status
      run: diff failed_result.txt known_failed.txt && diff error_result.txt known_errors.txt
